<!DOCTYPE html>
<html>

<head>
  <title>Todo 範例製作</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="images/favicon.ico" rel="shortcut icon">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="/stylesheets/all.css">
  <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/solid.js"
    integrity="sha384-+Ga2s7YBbhOD6nie0DzrZpJes+b2K1xkpKxTFFcx59QmVPaSA8c7pycsNaFwUK6l" crossorigin="anonymous">
  </script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/regular.js"
    integrity="sha384-t7yHmUlwFrLxHXNLstawVRBMeSLcXTbQ5hsd0ifzwGtN7ZF7RZ8ppM7Ldinuoiif" crossorigin="anonymous">
  </script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/fontawesome.js"
    integrity="sha384-7ox8Q2yzO/uWircfojVuCQOZl+ZZBg2D2J5nkpLqzH1HY0C1dHlTKIbpRz/LG23c" crossorigin="anonymous">
  </script>
  <script src="/javascripts/vendor.js"></script>

</head>

<body class="bg-lighter">
  <nav class="navbar navbar-expand-lg navbar-dark">
    
  </nav>
  <div class="container my-5">
    <div class="row">
      <div class="col-md-3">
        </div>
      </div>

      <div class="col-md-9 post">
        <!-- 練習開始 -->
        <!-- <h1 class="mt-0 text-muted">Todo 範例製作</h1> -->
        <!-- 功能需求
        1.建立todo(能打勾删除的)
            1.data
            2.html模板 綁定
            3.method 資料的新增
            4.?補label跟class
        2.删除todo(找到对应id)
            1.click
            2.method 資料的刪除
        3.页签(切换状态)
            1.data visibility
            2.?html 老師先先class確認切換 然後click方法
            3.寫computed 篩選資料
        4.编辑(资料站存)
            1.data?
            2.html? 先click還是v-if v-model也別忘了
            ---------
            老師先html dbclick 然後method測試todo有船進去反映
            寫data做暫存
            然後讓li 裡面兩個東西都呈現出來 再來寫v-if判斷暫存區有資料就出現
            看沒問題再來html寫v-model跟順便寫keyup
        -->
           
        <div class="alert alert-secondary">
          <ol class="mb-0">
            <!-- <li>請跟隨課程完成此章節。</li> -->
          </ol>
        </div>

        <div id="app">
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon1">待辦事項</span>
            </div>
            <input type="text" class="form-control" placeholder="準備要做的任務"
            v-model="newTodo"
            @keyup.enter="addTodo()"
            >
            <div class="input-group-append">
              <button class="btn btn-primary" type="button"
              @click="addTodo()"
              >新增</button>
            </div>
          </div>

          <div class="card text-center">
            <div class="card-header">
              <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item">
                  <a class="nav-link" href="#"
                  :class="{'active':visibility == 'all'}"
                  @click.prevent="visibility='all'"
                  >全部</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link " href="#"
                  :class="{'active':visibility == 'active'}"
                  @click.prevent="visibility='active'"
                  >進行中</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"
                  :class="{'active':visibility == 'completed'}"
                  @click.prevent="visibility='completed'"
                  >已完成</a>
                </li>
              </ul>
            </div>


            <ul class="list-group list-group-flush text-left">
              <li class="list-group-item"
              v-for="item in filterTodos2"
              @dblclick="editTodo(item)"
              >
                <div class="d-flex" 
                v-if="item.id!==cacheTodo.id">
                      <div class="form-check">
                          <input type="checkbox" class="form-check-input" 
                          :id="item.id"
                          v-model="item.completed"
                          >
                          <label class="form-check-label" 
                          :for="item.id"
                          :class="{'completed':item.completed}"
                          >
                            {{item.title}}
                          </label>
                      </div>
                      
                      <button type="button" class="close ml-auto" aria-label="Close"
                      @click="removeTodo(item)"
                      >
                          <span aria-hidden="true">&times;</span>
                      </button>
                </div>

                <!-- <li class="list-group-item"
                v-if="cacheTodo!={}"
                > -->

                <input type="text" class="form-control"
                v-if="item.id==cacheTodo.id"
                v-model="cacheTitle"
                @keyup.esc="cancelTodo()"
                @keyup.enter="doneTodo(item)"
                >

                <!-- </li> -->
              </li>

              <!-- <li class="list-group-item">
                <div class="d-flex">
                  <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="a1">
                    <label class="form-check-label completed" for="a1">
                      Cras justo odio
                    </label>
                  </div>
                  <button type="button" class="close ml-auto" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
              </li> -->

              <!-- <li class="list-group-item">
                <input type="text" class="form-control">
              </li> -->

            </ul>
            <!-- <div class="card-footer d-flex justify-content-between">
              <span>還有 3 筆任務未完成</span>
              <a href="#">清除所有任務</a>
            </div> -->
          </div>
        </div>

        <script>
          var app = new Vue({
            el: '#app',
            data: {
              newTodo:"",
              todos:[
                // {
                //   id:timestamp,
                //   title:"test",
                //   completed:false
                // }
              ],
              visibility:'all',
              cacheTitle:"",
              cacheTodo:{}
            },
            methods:{
              addTodo(){
                var vm = this;
                var value = vm.newTodo.trim();
                if(value!=""){
                  var timestamp = Math.floor(Date.now());
                  vm.todos.push({
                        id:timestamp,
                        title:value,
                        completed:false,
                  })
                  vm.newTodo="";
                }else{
                  return;
                } 
              },
              removeTodo(todo){
                var vm = this;
                var newIndex = "";
                vm.todos.forEach(function(item,index){
                  if(item.id==todo.id){
                      newIndex = index;
                  }
                })
                
                vm.todos.splice(newIndex,1);
              },
              editTodo(todo){
                var vm = this;
                vm.cacheTitle=todo.title;
                vm.cacheTodo=todo;//浅复制??>>>
              },
              cancelTodo(){
                var vm = this;
                vm.cacheTitle="";
                vm.cacheTodo={};
              },
              doneTodo(todo){
                var vm = this;
                todo.title=vm.cacheTitle;
                vm.cacheTitle="";
                vm.cacheTodo={};
              }
            
            },
            computed:{
              filterTodos1(){
                var vm = this;
                if(vm.visibility=="all"){
                  return vm.todos
                }else if(vm.visibility=="active"){
                  return vm.todos.filter(function(item){
                    return item.completed == false;
                  })                 
                  // vm.todos.filter(function(item,index){
                  //     return  if(!item.completed){
                        
                  //     }
                  // })
                }else if(vm.visibility=="completed"){
                  return vm.todos.filter(function(item){
                    return item.completed == true;
                  })
                }
              },
              filterTodos2(){
                  var vm=this;
                  var newTodos=[];
                  if(vm.visibility=="all"){
                    return vm.todos;
                  }else if(vm.visibility=="active"){
                    vm.todos.forEach(function(item){
                      if(!item.completed){
                        newTodos.push(item);
                      }
                    })
                    return newTodos;
                  }else if(vm.visibility=="completed"){
                    vm.todos.forEach((item)=>{
                      if(item.completed){
                        newTodos.push(item);
                      }
                    })
                    return newTodos;
                  }

              }
            }
          });
        </script>

        <style>
          .completed {
            text-decoration: line-through
          }
        </style>

      </div>
    </div>
  </div>
</body>

</html>